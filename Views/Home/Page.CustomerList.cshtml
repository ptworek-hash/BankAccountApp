@{
    Layout = null;
}

<!DOCTYPE html>
<html ng-app="CustomerApp">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Customer List - Customer Management System</title>
    
    <!-- AngularJS 1.6.9 as specified in requirements -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    
    <!-- Bootstrap for responsive design -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />

    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }

        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header-section h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 600;
        }

        .header-section p {
            margin: 5px 0 0 0;
            opacity: 0.9;
        }

        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        .stats-section {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        .customer-table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .customer-table {
            width: 100%;
            margin: 0;
        }

        .customer-table th {
            background-color: #f8f9fa;
            color: #495057;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #dee2e6;
            padding: 15px;
        }

        .customer-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
        }

        .customer-table tbody tr {
            transition: background-color 0.2s;
        }

        .customer-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .address-block {
            font-size: 0.9rem;
            color: #6c757d;
            white-space: pre-line;
        }

        .badge-custom {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .loading-spinner {
            text-align: center;
            padding: 50px;
        }

        .no-results {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        /* Responsive design for tablets */
        @media (max-width: 992px) {
            .customer-table th:nth-child(5),
            .customer-table td:nth-child(5) {
                display: none;
            }
        }

        /* Responsive design for mobile */
        @media (max-width: 768px) {
            .header-section h1 {
                font-size: 1.5rem;
            }

            .customer-table thead {
                display: none;
            }

            .customer-table,
            .customer-table tbody,
            .customer-table tr,
            .customer-table td {
                display: block;
                width: 100%;
            }

            .customer-table tr {
                margin-bottom: 15px;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                overflow: hidden;
            }

            .customer-table td {
                text-align: right;
                padding: 12px 15px;
                position: relative;
                border-bottom: 1px solid #e9ecef;
            }

            .customer-table td:last-child {
                border-bottom: none;
            }

            .customer-table td::before {
                content: attr(data-label);
                position: absolute;
                left: 15px;
                font-weight: 600;
                text-transform: uppercase;
                font-size: 0.75rem;
                color: #6c757d;
            }

            .customer-table td[data-label="Address"] {
                text-align: left;
                padding-top: 35px;
            }
        }

        /* Small mobile */
        @media (max-width: 576px) {
            body {
                padding: 10px;
            }

            .header-section {
                padding: 20px;
            }

            .filter-section {
                padding: 15px;
            }
        }
    </style>
</head>
<body ng-controller="CustomerController">

    <!-- Header Section -->
    <div class="header-section">
        <h1><i class="fas fa-users"></i> Customer Management System</h1>
        <p>View and manage all customers</p>
    </div>

    <!-- Error Message -->
    <div class="error-message" ng-show="error">
        <i class="fas fa-exclamation-triangle"></i> <strong>Error:</strong> {{ error }}
    </div>

    <!-- Filter Section (BONUS: Filter by any field) -->
    <div class="filter-section">
        <div class="row">
            <div class="col-md-6">
                <label><i class="fas fa-search"></i> Search Customers</label>
                <input type="text" 
                       ng-model="searchText" 
                       placeholder="Filter by any field (name, company, address, etc.)..." 
                       class="form-control" />
            </div>
            <div class="col-md-6">
                <label><i class="fas fa-filter"></i> Quick Filters</label>
                <div class="btn-group btn-group-sm" role="group">
                    <button type="button" 
                            class="btn btn-outline-secondary" 
                            ng-click="searchText = ''">
                        All Customers
                    </button>
                    <button type="button" 
                            class="btn btn-outline-secondary" 
                            ng-click="filterByState('CA')">
                        California
                    </button>
                    <button type="button" 
                            class="btn btn-outline-secondary" 
                            ng-click="filterByState('NY')">
                        New York
                    </button>
                    <button type="button" 
                            class="btn btn-outline-secondary" 
                            ng-click="filterByState('TX')">
                        Texas
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Section -->
    <div class="stats-section" ng-show="!loading && !error">
        <div class="row">
            <div class="col-md-4">
                <strong><i class="fas fa-database"></i> Total Customers:</strong> 
                {{ customers.length }}
            </div>
            <div class="col-md-4">
                <strong><i class="fas fa-filter"></i> Filtered Results:</strong> 
                {{ (customers | filter:searchText).length }}
            </div>
            <div class="col-md-4 text-right">
                <button class="btn btn-sm btn-primary" ng-click="refreshCustomers()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" ng-show="loading">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
        <p class="mt-3">Loading customers...</p>
    </div>

    <!-- Customer Table -->
    <div class="customer-table-container" ng-show="!loading && !error">
        <table class="customer-table table table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Company Name</th>
                    <th>Address</th>
                    <th>City, State</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="customer in customers | filter:searchText">
                    <td data-label="ID">
                        <span class="badge badge-secondary badge-custom">{{ customer.Id }}</span>
                    </td>
                    <td data-label="First Name">{{ customer.FirstName || '-' }}</td>
                    <td data-label="Last Name">
                        <strong>{{ customer.LastName }}</strong>
                    </td>
                    <td data-label="Company Name">
                        <i class="fas fa-building"></i> {{ customer.CompanyName }}
                    </td>
                    <td data-label="Address">
                        <div class="address-block" ng-show="customer.Address.AddressBlock">
                            {{ customer.Address.AddressBlock }}
                        </div>
                        <span class="text-muted" ng-show="!customer.Address.AddressBlock">
                            No address
                        </span>
                    </td>
                    <td data-label="City, State">
                        <span ng-show="customer.Address.City">
                            {{ customer.Address.City }}<span ng-show="customer.Address.State">, {{ customer.Address.State }}</span>
                        </span>
                        <span class="text-muted" ng-show="!customer.Address.City">-</span>
                    </td>
                </tr>
                <tr ng-show="(customers | filter:searchText).length === 0">
                    <td colspan="6" class="no-results">
                        <i class="fas fa-inbox fa-3x mb-3" style="color: #dee2e6;"></i>
                        <p>No customers found matching your search.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // AngularJS 1.6.9 Application
        var app = angular.module('CustomerApp', []);

        app.controller('CustomerController', function($scope, $http) {
            // Initialize scope variables
            $scope.customers = [];
            $scope.searchText = '';
            $scope.loading = true;
            $scope.error = null;

            // Load customers from the API
            $scope.loadCustomers = function() {
                $scope.loading = true;
                $scope.error = null;

                $http.get('/Customer/List')
                    .then(function(response) {
                        // API returns { success: true, data: [...], count: 10 }
                        if (response.data.success) {
                            $scope.customers = response.data.data;
                        } else {
                            $scope.error = response.data.error || 'Failed to load customers';
                        }
                        $scope.loading = false;
                    }, function(error) {
                        console.error('Error loading customers:', error);
                        $scope.error = 'Failed to load customers. Please check the server connection.';
                        $scope.loading = false;
                    });
            };

            // Refresh customers
            $scope.refreshCustomers = function() {
                $scope.loadCustomers();
            };

            // Quick filter by state
            $scope.filterByState = function(state) {
                $scope.searchText = state;
            };

            // Initial load
            $scope.loadCustomers();
        });
    </script>

    <!-- Bootstrap JS (optional, for enhanced features) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>('Error loading customers:', error);
                });
        });
    </script>
</body>
</html>